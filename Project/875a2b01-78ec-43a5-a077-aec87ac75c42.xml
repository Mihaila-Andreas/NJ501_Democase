{"CLs":[{"__type":"IST","EID":"3c108ba5-c191-4b23-8481-c81900e54942","H":130,"TXT":"(**************************************************************\u000d\u000a*\u0009strAdminData - Alarms History\u000d\u000a**************************************************************)\u000d\u000a\u000d\u000a\u000d\u000ax_Count[0](Clk:=myAlarmHistoryFilter_Done );\u000d\u000a\u000d\u000aIF (x_Count[0].Q)THEN  INC(uiEventCounter); END_IF;;\u000d\u000a\u000d\u000aIF myAlarmHistoryFilter_Done or bTest then\u000d\u000a\u000d\u000a\u0009\/\/Admin \/ Alarms history\u000d\u000a\u0009Clear(jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009JSONObj('Admin',jsBUFFER);\u0009\u0009\u0009\u000d\u000a\u000d\u000a\u0009\u0009\u0009\u0009JSONList(jsBUFFER,'Alarm');\u000d\u000a\u0009\u0009\u0009\u0009\u0009\/\/list  first new event\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSON_UINT('Nbr',uiEventCounter, jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSON_DINT('ID', myAlarmHistoryArray[0].EventType.ID,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSON_DINT('Category', myAlarmHistoryArray[0].EventType.Category ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSON_STRING('Msg', myAlarmHistoryArray[0].EventType.Message ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSON_BOOL('Active', myAlarmHistoryArray[0].Active ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSON_DATE('Occurred'\u0009, myAlarmHistoryArray[0].OccuredTime     ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009IF (myAlarmHistoryArray[0].Active ) = FALSE then\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_DATE('Reset'\u0009, myAlarmHistoryArray[0].AcknowledgedTime    ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\u0009\/\/list  simultaneous new events\u000d\u000a\u0009\u0009\u0009\u0009IF UNNumberOfActiveAlarms >1 THEN\u000d\u000a\u0009\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\u0009\u0009FOR idx:=1 TO UNNumberOfActiveAlarms  -1 do\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\u0009\u0009JSONAdd(jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_UINT('Nbr',uiEventCounter,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_DINT('ID', myAlarmHistoryArray[idx].EventType.ID,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_DINT('Category', myAlarmHistoryArray[idx].EventType.Category ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_STRING('Msg', myAlarmHistoryArray[idx].EventType.Message ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_BOOL('Active', myAlarmHistoryArray[idx].Active ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009JSON_DATE('Occurred'\u0009, myAlarmHistoryArray[idx].OccuredTime     ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009IF (myAlarmHistoryArray[idx].Active ) = FALSE then\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u0009JSON_DATE('Reset'\u0009, myAlarmHistoryArray[idx].AcknowledgedTime    ,jsBUFFER);\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\u0009\u0009END_FOR;\u000d\u000a\u0009\u0009\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\u0009JSONCloseList(jsBUFFER);\u000d\u000a\u0009\u0009  JSONCloseObj (jsBUFFER);\u000d\u000a\u0009  JSONCloseObj (jsBUFFER);\u000d\u000a\u0009\u000d\u000a\u000d\u000a\u0009MemCopy(In:=jsBUFFER.Data[0], AryOut:=bArrAlarmsHistory[0], Size:=jsBUFFER.p);\u000d\u000a\u0009uiAlarmHistorySize:=jsBUFFER.p;\u000d\u000a\u0009\u000d\u000a\u0009mqttUpdateAlm:=TRUE;\u000d\u000a\u000d\u000aEND_IF; \u000d\u000a\u000d\u000a\u000d\u000a\u000d\u000a;","W":400}],"LRI":1,"RRI":2,"VLs":[]}
